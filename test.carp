(load-and-use Test)

(load "./subprocess.carp")

(Debug.sanitize-addresses)

(def res (SubProcess.cmd &[@"sh" @"-c" @"printf 'this is stderr' 1>&2; printf 'this is stdout'; exit 42"]))

(deftest test
  (assert-equal test
                "this is stdout"
                (SubProcess.out &res)
                "out works with small output")
  (assert-equal test
                "this is stderr"
                (SubProcess.err &res)
                "err works with small output")
  (assert-equal test
                &42
                (SubProcess.exit-code &res)
                "exit-code works with small output"))
